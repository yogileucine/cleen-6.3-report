{"uid":"7fc070cf22a4affc","name":"Validate the audit logs details for updating Nitrosamine limit policy","fullName":"tests.scenarios.audit_logs.test_audit_logs_scenarios.TestAuditLogsScenarios#test_update_nitrosamine_limit_policy_validate_audit_logs_details","historyId":"474ac854316f24ceba941c94e824c8e7","time":{"start":1734439481741,"stop":1734439483972,"duration":2231},"description":"This test case test API to validate the updating Nitrosamine limit policy","descriptionHtml":"<p>This test case test API to validate the updating Nitrosamine limit policy</p>\n","status":"failed","statusMessage":"AssertionError: Expected 'Included' for new Use Global Recovery Percentage?, but got None\nassert None == 'Included'","statusTrace":"self = <test_audit_logs_scenarios.TestAuditLogsScenarios object at 0x7f81c3d14d40>\n\n    @allure.title(\"Validate the audit logs details for updating Nitrosamine limit policy\")\n    @allure.description(\"This test case test API to validate the updating Nitrosamine limit policy\")\n    @allure.link(\"https://app.clickup.com/t/86cvttem5\")\n    @pytest.mark.update_nitrosamine_limit_policy_validate_audit_logs_details\n    def test_update_nitrosamine_limit_policy_validate_audit_logs_details(self):\n        data = {}\n        data.update(const.DEFAULT_SURFACE_AREA_SQCM)\n        self.update_default_unit.test_update_default_unit(data)\n    \n        time_stamp = None\n        global_recovery_percentage = Excel.read_excel_col_name_row_number(const.get_master_data(),\n                                                                          \"config\",\n                                                                          \"global_recovery_percentage\",\n                                                                          2)\n        upper_limit = Excel.read_excel_col_name_row_number(const.get_master_data(),\n                                                           \"config\", \"upper_limit\", 2)\n    \n        policy_data = {\"salMassUnit\": \"ug\", \"globalRecoveryPercentage\": global_recovery_percentage,\n                       \"useGlobalRecoveryPercentage\": True, \"useResidueLimit\": True, \"residueLimit\": upper_limit,\n                       \"residue_unit\": \"ug/sqcm\", \"useSwabPerSampleLimit\": False, \"useRinsePerSampleLimit\": False,\n                       \"rinseSampleUnit\": \"ppm\", \"swabSampleUnit\": \"ppm\", \"useSampleLimit\": True,\n                       \"rinseSampleLimit\": \"11\", \"swabSampleLimit\": \"12\"}\n        get_policy = json.loads(self.update_nitrosamine.test_get_nitrosamine_cleaning_limit_policy())\n        get_policy = get_policy[\"policy\"]\n        update_policy = create_cleaning_limit_policy_nitrosamine_payload(get_policy, policy_data)\n        data.update({\"update_policy_payload\": update_policy})\n        if get_policy != update_policy[\"data\"]:\n            time_stamp = self.update_nitrosamine.test_update_nitrosamine_limit_policy(data)[\"timestamp\"]\n    \n        audit_logs_details = self.validate_audit_logs.audit_logs_details()\n    \n        for index, result in enumerate(audit_logs_details.get(\"audit_logs\", {}).get(\"result\", [])):\n            response_time_stamp = result.get(\"timestamp\")\n            time_stamp = str(time_stamp)\n            action_exists = result.get(\"action\") is not None\n            domain_is_default_unit = result.get(\"domain\") == \"CleaningPolicy\"\n    \n            audit_diff = result.get(\"diff\", {})\n    \n            if audit_diff.get(\n                    self.nitrosamine_upper_limits) is not None and action_exists and domain_is_default_unit:\n                self.validate_audit_logs.assert_audit_diff(audit_diff, self.sal_mass_unit, const.SAL_MASS_UNIT_MG,\n                                                           const.SAL_MASS_UNIT_UG)\n                self.validate_audit_logs.assert_audit_diff(audit_diff, self.global_recovery, '100',\n                                                           str(global_recovery_percentage))\n>               self.validate_audit_logs.assert_audit_diff(audit_diff, self.use_global_recovery_percentage,\n                                                           None,\n                                                           const.INCLUDED)\n\ntests/scenarios/audit_logs/test_audit_logs_scenarios.py:2582: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <unit.audit_logs.test_audit_logs.TestAuditLogs object at 0x7f81c47e0890>\naudit_diff = {'ARL': {'type': 'unchanged'}, 'Active to Active Policy Selection Preference': {'type': 'unchanged'}, 'Cleaning Limit ...n equipment': {'type': 'unchanged'}, 'Concentration Limit Unit For Rinse Limit In Reports': {'type': 'unchanged'}, ...}\nkey = 'Use Global Recovery Percentage?', expected_old_value = None, expected_new_value = 'Included'\n\n    def assert_audit_diff(self, audit_diff, key, expected_old_value, expected_new_value):\n        old_value = audit_diff.get(key, {}).get(\"data\", {}).get(\"old\", {}).get(\"value\")\n        new_value = audit_diff.get(key, {}).get(\"data\", {}).get(\"new\", {}).get(\"value\")\n    \n        if isinstance(expected_old_value, datetime) or isinstance(expected_new_value, datetime):\n            self.get_diff_time_stamp(old_value, expected_old_value)\n    \n        assert old_value == expected_old_value, f\"Expected '{expected_old_value}' for old {key}, but got {old_value}\"\n>       assert new_value == expected_new_value, f\"Expected '{expected_new_value}' for new {key}, but got {new_value}\"\nE       AssertionError: Expected 'Included' for new Use Global Recovery Percentage?, but got None\nE       assert None == 'Included'\n\ntests/unit/audit_logs/test_audit_logs.py:131: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"login","time":{"start":1734429604694,"stop":1734429605014,"duration":320},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"get_facility","time":{"start":1734429605014,"stop":1734429605194,"duration":180},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[],"labels":[{"name":"tag","value":"update_nitrosamine_limit_policy_validate_audit_logs_details"},{"name":"tag","value":"run(order=-2)"},{"name":"tag","value":"second_to_last"},{"name":"tag","value":"audit_logs_scenarios"},{"name":"tag","value":"scenario"},{"name":"parentSuite","value":"tests.scenarios.audit_logs"},{"name":"suite","value":"test_audit_logs_scenarios"},{"name":"subSuite","value":"TestAuditLogsScenarios"},{"name":"host","value":"ubuntu"},{"name":"thread","value":"1892009-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.scenarios.audit_logs.test_audit_logs_scenarios"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[{"name":"https://app.clickup.com/t/86cvttem5","url":"https://app.clickup.com/t/86cvttem5","type":"link"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":["scenario","update_nitrosamine_limit_policy_validate_audit_logs_details","audit_logs_scenarios","second_to_last","run(order=-2)"]},"source":"7fc070cf22a4affc.json","parameterValues":[]}